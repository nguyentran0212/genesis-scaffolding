name: "Write about Arxiv Paper"
description: "A sample multi-step writing workflow."
version: "1.0"

inputs:
  writing_instruction:
    type: "string"
    description: "Additional instruction to guide the writing."
    default: | 
      This article is for promoting a research pre-print that our team has just published.
      Remember to introduce our paper and provide information for readers to access the paper.
      The information about the paper should be right at the beginning to emphasise that this is the paper we published.
  arxiv_paper_id:
    type: "string"
    description: "ID of Arxiv paper to use as input"
    default: 500
  content_length:
    type: "int"
    description: "Target word count."
    default: 500
  input_files:
    type: "list[file]"
    description: "List of files to provide to the agent."
    default: []

steps:
  - id: "file_ingest_step"
    type: "file_ingest"
    params:
      files_to_read: "{{ inputs.input_files }}"

  - id: "arxiv_download"
    type: "arxiv_download"
    params:
      arxiv_paper_ids: 
        - "{{ inputs.arxiv_paper_id }}"

  - id: "agent_outline"
    type: "agent_map"
    params:
      files_to_read: "{{ steps.arxiv_download.file_paths}}"
      agent: "technical_writer_outline"
      prompts: 
        - |
          Create a detailed outline for a blog post promoting the research from the paper provided in your clipboard.

          Ensure that you provide an introduction to the paper in the opening hook.

          Don't try to mimic the structure of a research paper. Instead, structure the blog post organically so that it is readable to technical readers.

          Ensure it is structured for a {{ inputs.content_length }} word article.

          ## Paper's details

          {{ steps.arxiv_download.content }}

          ## Additional User's Instructions About the Blog Post

          {{ inputs.writing_instruction }}

          Only write the content of the outline in your output.
      output_filename: "agent_outline.md"

  - id: "agent_drafting"
    type: "agent_map"
    params:
      files_to_read:
        - "{{ steps.arxiv_download.file_paths[0] }}"
        - "internal/agent_outline.md"
      agent: "technical_writer_draft"
      prompts:
        - | 
          Please write the article about the paper based on the outine. 
          Both the source paper and the outline are provided in your clipboard.
          Target length is {{ inputs.content_length }} words. 
          
          ## Paper's details

          {{ steps.arxiv_download.content }}

          ## Additional User's Instructions About the Blog Post

          {{ inputs.writing_instruction }}
      output_filename: "agent_draft.md"


  - id: "agent_editing"
    type: "agent_map"
    params:
      agent: "technical_writer_editor"
      files_to_read:
        - "internal/agent_outline.md"
        - "internal/agent_draft.md"
      prompts: 
        - |
          Review and polish the blog post draft provided in your clipboard.
          The draft is supposed to follow the outline, which is also provided in your clipboard
          Target length is {{ inputs.content_length }} words. 

          ## Paper's details

          {{ steps.arxiv_download.content }}

          ## Additional User's Instructions About the Blog Post

          {{ inputs.writing_instruction }}

          Remember to remove all the comments, prefix, postfix, and any mentioning of word counts.
      output_filename: "agent_final.md"
      write_response_to_output: True

  - id: "agent_twitter"
    type: "agent_map"
    params:
      agent: "technical_writer_twitter"
      files_to_read:
        - "internal/agent_final.md"
      prompts: 
        - |
          The blog post that you need to write twitter thread to promote is in your clipboard.

          ## Additional User's Instructions

          {{ inputs.writing_instruction }}

          ## Paper's details

          {{ steps.arxiv_download.content }}
      output_filename: "twitter_thread.md"
      write_response_to_output: True

  - id: "agent_linkedin"
    type: "agent_map"
    params:
      agent: "technical_writer_linkedin"
      files_to_read:
        - "internal/agent_final.md"
      prompts: 
        - |
          The blog post that you need to write linkedin post to promote is in your clipboard

          ## Additional User's Instructions

          {{ inputs.writing_instruction }}

          ## Paper's details

          {{ steps.arxiv_download.content }}
      output_filename: "linkedin_post.md"
      write_response_to_output: True

  - id: "agent_visual"
    type: "agent_map"
    params:
      agent: "technical_writer_visual"
      files_to_read:
        - "internal/agent_final.md"
      prompts: 
        - |
          The source material you need to work on is provided in your clipboard.
      output_filename: "visual_recommendations.md"
      write_response_to_output: True

outputs:
  blog_post:
    description: "The final edited version of the article."
    value: "{{ steps.agent_editing.content }}"
  blog_post_output_path:
    description: "File path to the final markdown file."
    value: "{{ steps.agent_editing.file_paths }}"
  twitter_thread:
    description: "Twitter thread of the article."
    value: "{{ steps.agent_twitter.content }}"
  linkedin_post:
    description: "LinkedIn post of the article."
    value: "{{ steps.agent_linkedin.content }}"
  visual_recs::
    description: "Recommendations for visuals."
    value: "{{ steps.agent_visual.content }}"
