name: "Daily Technology Briefing"
description: "Curate the latest technical engineering blogs."
version: "1.0"

inputs:
  topic:
    type: "string"
    description: "Topic for research briefing"
    default: "AI agent at the edge"
  feeds:
    type: "list[string]"
    description: "List of RSS feed URLs"
    default: 
      - "https://deepmind.com/blog/feed/basic"
      - "https://research.google/blog/rss/"
      - "https://openai.com/feed.xml?format=xml"
      - "https://feeds.feedburner.com/nvidiablog"
      - "https://www.anthropic.com/news"
      - "https://huggingface.co/blog?tag=research"
  lookback_days:
    type: "int"
    description: "How many days back to look"
    default: 1
  max_results:
    type: "int"
    description: "Max number of rss feed item to process"
    default: 10
  briefing_title:
    type: "string"
    description: "Title of the Research Briefing"
    default: "Tech Pulse on Local AI"

steps:
  - id: "fetch_feeds"
    type: "rss_fetch"
    params:
      feed_urls: "{{ inputs.feeds }}"
      since_days: "{{ inputs.lookback_days }}"

  - id: "filter_relevant_items"
    type: "agent_projection"
    params:
      agent: "simple_agent"
      # We pass the list of RSS entries as the prompt for filtering
      prompt:
        - |
          Below is a list of recent RSS feed items. Analyze them and identify items related to {{ inputs.topic }}.

          For each relevant item, extract the URL.

          ## Items

          {{ steps.fetch_feeds.content }}
      expected_item_type: "URLs"
      max_number: "{{ inputs.max_results }}"

  # Map: Fetch the content of those specific URLs
  - id: "fetch_content"
    type: "web_fetch"
    condition: "{{ steps.filter_relevant_items.content | length > 0 }}"
    params:
      urls: "{{ steps.filter_relevant_items.content }}"

  # Reduce: The "Tech Pulse" Report
  - id: "newsletter"
    type: "agent_reduce"
    condition: "{{ steps.fetch_content.content | length > 0 }}"
    params:
      agent: "technical_writer_draft"
      prompts: "{{ steps.fetch_content.content }}"
      reduction_instruction: >
        Create a research briefing update about the topic {{ inputs.topic }} based on the summary of relevant articles below.

        These articles are from the last {{ inputs.lookback_days }} days until today. 

        TITLE: Name the research briefing using the current date and the title {{ inputs.briefing_title }}.
        
        STRUCTURE:
        1. The Big Picture: A 1-paragraph overview of the articles we are going to share in this blog post.
        2. Deep Dive Spotlights: For each article, create a section:
           - Article Title & Source (Mention the site/company)
           - The 'What': A technical summary with enough details.
           - The 'Why': The practical implication for developer.
        
        TONE: Authoritative, respectful to the engineers who wrote the original posts, and focused on utility.
      output_filename: "Tech_Pulse_Report.md"
      write_response_to_output: True

  # Promo: LinkedIn Social Post
  - id: "promo"
    type: "agent_map"
    params:
      agent: "technical_writer_linkedin"
      prompts: "{{ steps.newsletter.content }}"
      prompts_prefix: "Create a LinkedIn post that shares the key insights from this technical report. Do not use hype. Use a 'curator' tone. Focus on helping other devs save time. THE REPORT: "
      output_filename: "linkedin_promo.md"
      write_response_to_output: True

outputs:
  report_path:
    description: "The generated newsletter"
    value: "{{ steps.newsletter.content[0] }}"
  linkedin_post:
    description: "Social media copy"
    value: "{{ steps.promo.content[0] }}"
